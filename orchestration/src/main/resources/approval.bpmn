<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_1oa9vab" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.36.0">
  <bpmn:process id="approval" name="Approval" isExecutable="true" camunda:historyTimeToLive="P1D">
    <bpmn:startEvent id="approval_requested" name="Approval requested" camunda:asyncAfter="true">
      <bpmn:outgoing>SequenceFlow_1ybc6go</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="SequenceFlow_1ybc6go" sourceRef="approval_requested" targetRef="join_resubmit" />
    <bpmn:endEvent id="request_approved" name="Request approved">
      <bpmn:extensionElements>
        <camunda:executionListener expression="${audit.log(&#34;Approved&#34;)}" event="start" />
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_0cqdv63</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="SequenceFlow_0ud27qg" sourceRef="service_load_approval_request" targetRef="service_determine_approval_strategy" />
    <bpmn:serviceTask id="service_load_approval_request" name="Load approval request" camunda:delegateExpression="${loadApprovalRequestDelegate}">
      <bpmn:incoming>SequenceFlow_0agopj5</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0ud27qg</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="SequenceFlow_1jiy37o" sourceRef="service_determine_approval_strategy" targetRef="xor_approval_strategy" />
    <bpmn:exclusiveGateway id="xor_approval_strategy" name="Approval strategy?" default="flow_manual">
      <bpmn:incoming>SequenceFlow_1jiy37o</bpmn:incoming>
      <bpmn:outgoing>flow_automatic</bpmn:outgoing>
      <bpmn:outgoing>flow_manual</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="flow_automatic" name="Automatic" sourceRef="xor_approval_strategy" targetRef="service_auto_approve_delegate">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approvalStrategy == "Automatic"}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:endEvent id="request_rejected" name="Request rejected">
      <bpmn:extensionElements>
        <camunda:executionListener expression="${audit.log(&#34;Rejected&#34;)}" event="start" />
      </bpmn:extensionElements>
      <bpmn:incoming>flow_rejected</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="flow_manual" name="Manual" sourceRef="xor_approval_strategy" targetRef="ExclusiveGateway_1wep4b2" />
    <bpmn:sequenceFlow id="SequenceFlow_06pxplx" sourceRef="service_auto_approve_delegate" targetRef="ExclusiveGateway_0aog2p3" />
    <bpmn:serviceTask id="service_auto_approve_delegate" name="Auto approve&#10;request" camunda:delegateExpression="${automaticApproveRequestDelegate}">
      <bpmn:incoming>flow_automatic</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_06pxplx</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="SequenceFlow_06viepv" sourceRef="task_approve_request" targetRef="xor_approval_decision" />
    <bpmn:userTask id="task_approve_request" name="Approve&#10;request" camunda:asyncAfter="true">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="approvalDecision" label="Approve decision" type="enum">
            <camunda:value id="APPROVED" name="APPROVED" />
            <camunda:value id="REJECTED" name="REJECTED" />
            <camunda:value id="RETURNED" name="RETURNED" />
          </camunda:formField>
        </camunda:formData>
        <camunda:taskListener delegateExpression="${manualApprovalGuard}" event="complete" />
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_1g930p7</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_06viepv</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="xor_approval_decision" name="Approval&#10;decision?">
      <bpmn:incoming>SequenceFlow_06viepv</bpmn:incoming>
      <bpmn:outgoing>flow_rejected</bpmn:outgoing>
      <bpmn:outgoing>flow_approved</bpmn:outgoing>
      <bpmn:outgoing>flow_returned</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="flow_rejected" name="Rejected" sourceRef="xor_approval_decision" targetRef="request_rejected">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approvalDecision == 'REJECTED'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:exclusiveGateway id="ExclusiveGateway_0aog2p3">
      <bpmn:incoming>SequenceFlow_06pxplx</bpmn:incoming>
      <bpmn:incoming>flow_approved</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0cqdv63</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="SequenceFlow_0cqdv63" sourceRef="ExclusiveGateway_0aog2p3" targetRef="request_approved" />
    <bpmn:sequenceFlow id="flow_approved" name="Approved" sourceRef="xor_approval_decision" targetRef="ExclusiveGateway_0aog2p3">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approvalDecision == 'APPROVED'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="flow_returned" name="Returned to originator" sourceRef="xor_approval_decision" targetRef="task_amend_request">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approvalDecision == 'RETURNED'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:userTask id="task_amend_request" name="Amend&#10;request" camunda:asyncAfter="true">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="amendAction" label="Amend decision" type="enum">
            <camunda:value id="RESUBMITTED" name="RESUBMITTED" />
            <camunda:value id="CANCELLED" name="CANCELLED" />
          </camunda:formField>
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:incoming>flow_returned</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1g5mucv</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="xor_amend_action" name="Resubmit?">
      <bpmn:incoming>SequenceFlow_1g5mucv</bpmn:incoming>
      <bpmn:outgoing>flow_resubmitted</bpmn:outgoing>
      <bpmn:outgoing>flow_cancelled</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="SequenceFlow_1g5mucv" sourceRef="task_amend_request" targetRef="xor_amend_action" />
    <bpmn:endEvent id="request_cancelled" name="Cancelled">
      <bpmn:extensionElements>
        <camunda:executionListener expression="${audit.log(&#34;Cancelled&#34;)}" event="start" />
      </bpmn:extensionElements>
      <bpmn:incoming>flow_finally_cancelled</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:exclusiveGateway id="join_resubmit">
      <bpmn:incoming>SequenceFlow_1ybc6go</bpmn:incoming>
      <bpmn:incoming>flow_resubmitted</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0agopj5</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="SequenceFlow_0agopj5" sourceRef="join_resubmit" targetRef="service_load_approval_request" />
    <bpmn:sequenceFlow id="flow_resubmitted" name="yes" sourceRef="xor_amend_action" targetRef="join_resubmit">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${amendAction == 'RESUBMITTED'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:businessRuleTask id="service_determine_approval_strategy" name="Determine approval strategy" camunda:resultVariable="approvalStrategy" camunda:decisionRef="approvalStrategy" camunda:mapDecisionResult="singleEntry">
      <bpmn:incoming>SequenceFlow_0ud27qg</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1jiy37o</bpmn:outgoing>
    </bpmn:businessRuleTask>
    <bpmn:sequenceFlow id="SequenceFlow_0momrwz" sourceRef="error" targetRef="ExclusiveGateway_1wep4b2" />
    <bpmn:boundaryEvent id="error" name="Approval error" attachedToRef="service_auto_approve_delegate">
      <bpmn:outgoing>SequenceFlow_0momrwz</bpmn:outgoing>
      <bpmn:errorEventDefinition errorRef="Error_1sbjnzr" />
    </bpmn:boundaryEvent>
    <bpmn:exclusiveGateway id="ExclusiveGateway_1wep4b2">
      <bpmn:incoming>flow_manual</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_0momrwz</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1g930p7</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="SequenceFlow_1g930p7" sourceRef="ExclusiveGateway_1wep4b2" targetRef="task_approve_request" />
    <bpmn:sequenceFlow id="flow_cancelled" name="no" sourceRef="xor_amend_action" targetRef="ExclusiveGateway_155gwi8">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${amendAction == 'CANCELLED'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:exclusiveGateway id="ExclusiveGateway_155gwi8">
      <bpmn:incoming>flow_cancelled</bpmn:incoming>
      <bpmn:incoming>flow_cancelled_by_timout</bpmn:incoming>
      <bpmn:outgoing>flow_finally_cancelled</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="flow_finally_cancelled" sourceRef="ExclusiveGateway_155gwi8" targetRef="request_cancelled" />
    <bpmn:sequenceFlow id="flow_cancelled_by_timout" sourceRef="timer" targetRef="ExclusiveGateway_155gwi8" />
    <bpmn:boundaryEvent id="timer" name="2min" attachedToRef="task_amend_request">
      <bpmn:outgoing>flow_cancelled_by_timout</bpmn:outgoing>
      <bpmn:timerEventDefinition>
        <bpmn:timeDuration xsi:type="bpmn:tFormalExpression">PT2M</bpmn:timeDuration>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>
  </bpmn:process>
  <bpmn:error id="Error_1sbjnzr" name="error_auto_approval" errorCode="automaticApprovalError" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="approval">
      <bpmndi:BPMNEdge id="SequenceFlow_1pz30g0_di" bpmnElement="flow_cancelled_by_timout">
        <di:waypoint x="988" y="376" />
        <di:waypoint x="988" y="345" />
        <di:waypoint x="1050" y="345" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1pxcdce_di" bpmnElement="flow_finally_cancelled">
        <di:waypoint x="1100" y="345" />
        <di:waypoint x="1156" y="345" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0om29yr_di" bpmnElement="flow_cancelled">
        <di:waypoint x="1075" y="409" />
        <di:waypoint x="1075" y="370" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1052" y="386" width="13" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1g930p7_di" bpmnElement="SequenceFlow_1g930p7">
        <di:waypoint x="749" y="249" />
        <di:waypoint x="773" y="249" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0momrwz_di" bpmnElement="SequenceFlow_0momrwz">
        <di:waypoint x="843" y="178" />
        <di:waypoint x="843" y="188" />
        <di:waypoint x="724" y="188" />
        <di:waypoint x="724" y="224" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0w8t2os_di" bpmnElement="flow_resubmitted">
        <di:waypoint x="1075" y="459" />
        <di:waypoint x="1075" y="512" />
        <di:waypoint x="236" y="512" />
        <di:waypoint x="236" y="274" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1045" y="474" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0agopj5_di" bpmnElement="SequenceFlow_0agopj5">
        <di:waypoint x="261" y="249" />
        <di:waypoint x="284" y="249" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1g5mucv_di" bpmnElement="SequenceFlow_1g5mucv">
        <di:waypoint x="1007" y="434" />
        <di:waypoint x="1050" y="434" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1iw6339_di" bpmnElement="flow_returned">
        <di:waypoint x="957" y="274" />
        <di:waypoint x="957" y="394" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="893" y="290" width="58" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1ckkiyj_di" bpmnElement="flow_approved">
        <di:waypoint x="957" y="224" />
        <di:waypoint x="957" y="145" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="967" y="182" width="48" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0cqdv63_di" bpmnElement="SequenceFlow_0cqdv63">
        <di:waypoint x="982" y="120" />
        <di:waypoint x="1156" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1ag47gs_di" bpmnElement="flow_rejected">
        <di:waypoint x="982" y="249" />
        <di:waypoint x="1156" y="249" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1041" y="228" width="44" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_06viepv_di" bpmnElement="SequenceFlow_06viepv">
        <di:waypoint x="873" y="249" />
        <di:waypoint x="932" y="249" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_06pxplx_di" bpmnElement="SequenceFlow_06pxplx">
        <di:waypoint x="873" y="120" />
        <di:waypoint x="932" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0a7rh72_di" bpmnElement="flow_manual">
        <di:waypoint x="626" y="249" />
        <di:waypoint x="699" y="249" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="633" y="227" width="37" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0uueyax_di" bpmnElement="flow_automatic">
        <di:waypoint x="601" y="224" />
        <di:waypoint x="601" y="120" />
        <di:waypoint x="773" y="120" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="607" y="177" width="49" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1jiy37o_di" bpmnElement="SequenceFlow_1jiy37o">
        <di:waypoint x="533" y="249" />
        <di:waypoint x="576" y="249" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0ud27qg_di" bpmnElement="SequenceFlow_0ud27qg">
        <di:waypoint x="384" y="249" />
        <di:waypoint x="433" y="249" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1ybc6go_di" bpmnElement="SequenceFlow_1ybc6go">
        <di:waypoint x="193" y="249" />
        <di:waypoint x="211" y="249" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="approval_requested">
        <dc:Bounds x="157" y="231" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="153" y="274" width="49" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_1y43zg5_di" bpmnElement="request_approved">
        <dc:Bounds x="1156" y="102" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1131" y="145" width="90" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_1e88nnc_di" bpmnElement="service_load_approval_request">
        <dc:Bounds x="284" y="209" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ExclusiveGateway_01u5t10_di" bpmnElement="xor_approval_strategy" isMarkerVisible="true">
        <dc:Bounds x="576" y="224" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="578" y="284" width="46" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_1wq77kj_di" bpmnElement="request_rejected">
        <dc:Bounds x="1156" y="231" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1133" y="274" width="84" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_1e2ku4m_di" bpmnElement="service_auto_approve_delegate">
        <dc:Bounds x="773" y="80" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="UserTask_0urhf24_di" bpmnElement="task_approve_request">
        <dc:Bounds x="773" y="209" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ExclusiveGateway_1yrjtc6_di" bpmnElement="xor_approval_decision" isMarkerVisible="true">
        <dc:Bounds x="932" y="224" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="967" y="266" width="47" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ExclusiveGateway_0aog2p3_di" bpmnElement="ExclusiveGateway_0aog2p3" isMarkerVisible="true">
        <dc:Bounds x="932" y="95" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="UserTask_1argtov_di" bpmnElement="task_amend_request">
        <dc:Bounds x="907" y="394" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ExclusiveGateway_0ak8ebm_di" bpmnElement="xor_amend_action" isMarkerVisible="true">
        <dc:Bounds x="1050" y="409" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1105" y="427" width="53" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_09c9ixh_di" bpmnElement="request_cancelled">
        <dc:Bounds x="1156" y="327" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1150" y="370" width="49" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ExclusiveGateway_1r6peaj_di" bpmnElement="join_resubmit" isMarkerVisible="true">
        <dc:Bounds x="211" y="224" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BusinessRuleTask_0vkrxnh_di" bpmnElement="service_determine_approval_strategy">
        <dc:Bounds x="433" y="209" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ExclusiveGateway_1wep4b2_di" bpmnElement="ExclusiveGateway_1wep4b2" isMarkerVisible="true">
        <dc:Bounds x="699" y="224" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ExclusiveGateway_155gwi8_di" bpmnElement="ExclusiveGateway_155gwi8" isMarkerVisible="true">
        <dc:Bounds x="1050" y="320" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BoundaryEvent_06fe07m_di" bpmnElement="timer">
        <dc:Bounds x="970" y="376" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1002" y="366" width="24" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BoundaryEvent_1y9qv4j_di" bpmnElement="error">
        <dc:Bounds x="825" y="142" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="867" y="161" width="70" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
